---
title: "RNA-seq course - week 2. Differential expression"
author: "Oleksandr Petrenko"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
  html_document:
    code_folding: hide
    df_print: paged
    highlights: pygments
    number_sections: yes
    self_contained: yes
    theme: default
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
editor_options: 
  chunk_output_type: inline
---

## Setup

```{r setup}
knitr::opts_knit$set(root.dir = '~/projects/2023_rnaseq_course/week2')
setwd("~/projects/2023_rnaseq_course/week2")
```


```{r install-packages}
#BiocManager::install("DEGreport")
```


```{r load-libraries-and-files}
library(DESeq2)
library(DEGreport)
library(tidyverse)
library(EnhancedVolcano)

getwd()
count_matrix_filtered <- read.csv("03_outputs/01_count_matrix_filtered.csv", row.names = 1)
metadata_table <- read.csv("01_datasets/metadata.csv", row.names = 1)
genes_mapped <- read.csv("03_outputs/01_gene_names_mapped.csv")
```

## LRT

```{r}
dds <- DESeqDataSetFromMatrix(countData = count_matrix_filtered, colData = metadata_table,
                              design = ~ fibroblast_line + treatment)

dds_lrt <- DESeq(dds, test = "LRT", reduced = ~ 1)
```

```{r}
lrt_genes <- results(dds_lrt) %>% as.data.frame() %>% filter(padj < 0.01)
lrt_subset <- lrt_genes %>% arrange(padj) %>% head(n = 1000)
lrt_subset <- lrt_subset %>% tibble::rownames_to_column("X")
```


```{r}
matrix_lrt <- assay(dds_lrt)[lrt_subset$X, ]

matrix_lrt <- varianceStabilizingTransformation(matrix_lrt)
```

```{r}
metadata_table$treatment <- as.factor(metadata_table$treatment)
degPatterns(matrix_lrt, metadata = metadata_table, time = "treatment", col = NULL)
```

```{r}
## які існують методи dimensionality reduction
## eigenvector & eigenvalue (PCA)

## VST (normalization)
```

## Wald
https://hbctraining.github.io/DGE_workshop_salmon/lessons/05_DGE_DESeq2_analysis2.html




